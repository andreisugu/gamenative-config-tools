<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameNative Config Converter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        h1 {
            color: #4ec9b0;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            color: #858585;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        textarea {
            width: 100%;
            flex: 1;
            min-height: 400px;
            padding: 15px;
            background-color: #252526;
            color: #d4d4d4;
            border: 2px solid #3e3e42;
            border-radius: 5px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #4ec9b0;
        }

        textarea::placeholder {
            color: #6a6a6a;
        }

        .button-container {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 12px 24px;
            background-color: #0e639c;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #1177bb;
        }

        button:active {
            background-color: #0d5a8f;
        }

        .error-message {
            color: #f48771;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }

        .success-message {
            color: #4ec9b0;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }

        .info {
            background-color: #2d2d30;
            padding: 15px;
            border-left: 3px solid #4ec9b0;
            margin-bottom: 20px;
            border-radius: 3px;
        }

        .info h3 {
            color: #4ec9b0;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .info p {
            color: #b0b0b0;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .info code {
            background-color: #1e1e1e;
            padding: 2px 6px;
            border-radius: 3px;
            color: #ce9178;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>GameNative Config Converter</h1>
        <p class="subtitle">Converts raw configurations into usable game configurations</p>
        
        <div class="info">
            <h3>How to use:</h3>
            <p>
                Enter your configuration with alternating key-value pairs on separate lines.<br>
                Line N = Key, Line N+1 = Value<br>
                Values like <code>true</code>/<code>false</code> will be converted to booleans, and numeric strings will be converted to numbers.
            </p>
        </div>

        <textarea id="inputText" placeholder="id&#10;12345&#10;wineVersion&#10;8.0&#10;graphicsDriverAdreno&#10;avg fps&#10;60&#10;session length sec&#10;120"></textarea>
        
        <div class="button-container">
            <button id="downloadBtn" onclick="convertAndDownload()">Download JSON</button>
        </div>
        
        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message"></div>
    </div>

    <script>
        const BUTTON_KEYS = new Set([
            "A", "B", "X", "Y", "L1", "L2", "L3", "R1", "R2", "R3", "START", "SELECT", 
            "DPAD UP", "DPAD DOWN", "DPAD LEFT", "DPAD RIGHT"
        ]);

        const KNOWN_KEYS = new Set([
            "id", "name", "drives", "lc all", "cpuList", "envVars", "showFPS", 
            "useDRI3", "emulator", "execArgs", "forceDlc", "language", "rcfileId", 
            "dxwrapper", "extraData", "profileId", "appVersion", "imgVersion", 
            "audioDriver", "box64Version", "desktopTheme", "wincomponents", 
            "config changed", "fexcoreVersion", "graphicsDriver", "sharpnessLevel", 
            "sharpnessEffect", "sharpnessDenoise", "startupSelection", "graphicsDriverAdreno",
            "lastInstalledMainWrapper", "discord support prompt shown", "inputType", 
            "steamType", "wow64Mode", "screenSize", "box64Preset", "box86Preset", 
            "installPath", "wineVersion", "box86Version", "cpuListWoW64", "useLegacyDRM", 
            "fexcorePreset", "midiSoundFont", "executablePath", "needsUnpacking", 
            "dxwrapperConfig", "launchRealSteam", "sessionMetadata", "avg fps", 
            "session length sec", "touchscreenMode", "containerVariant", "dinputMapperType", 
            "sdlControllerAPI", "allowSteamUpdates", "controllerMapping", "disableMouseInput", 
            "primaryController", "emulateKeyboardMouse", "graphicsDriverConfig", 
            "graphicsDriverVersion", "controllerEmulationBindings",
            ...BUTTON_KEYS
        ]);

        function parseValue(value) {
            // Trim whitespace
            const trimmedValue = value.trim();
            
            // Convert "true" to boolean true
            if (trimmedValue === 'true') {
                return true;
            }
            
            // Convert "false" to boolean false
            if (trimmedValue === 'false') {
                return false;
            }
            
            // Check if it's a number
            if (/^-?\d+(\.\d+)?$/.test(trimmedValue)) {
                const numValue = Number(trimmedValue);
                // Only convert if it's a valid number (not NaN or Infinity)
                if (!isNaN(numValue) && isFinite(numValue)) {
                    return numValue;
                }
            }
            
            // Return as string if no conversion applies
            return trimmedValue;
        }

        function parseButtonBindings(lines, startIndex) {
            const bindings = {};
            let i = startIndex;
            
            // Collect all button key-value pairs
            while (i < lines.length) {
                const buttonKey = lines[i].trim();
                
                // Check if this is a button key
                if (BUTTON_KEYS.has(buttonKey)) {
                    // Get the value for this button
                    if (i + 1 < lines.length) {
                        const buttonValue = lines[i + 1].trim();
                        
                        // Check if next line is another button key or a non-button known key
                        // If it's another button key, current button has no value
                        // If it's a non-button known key, we're done with bindings
                        if (BUTTON_KEYS.has(buttonValue)) {
                            // Next line is another button, so this button has empty value
                            bindings[buttonKey] = "";
                            i++; // Move to next button
                        } else if (KNOWN_KEYS.has(buttonValue)) {
                            // Next line is a non-button key, we're done collecting bindings
                            bindings[buttonKey] = "";
                            i++; // Move past this button, outer loop will handle the key
                            break;
                        } else {
                            // Next line is a value for this button
                            bindings[buttonKey] = parseValue(buttonValue);
                            i += 2; // Skip both button key and its value
                        }
                    } else {
                        // No more lines, button has no value
                        bindings[buttonKey] = "";
                        i++;
                    }
                } else {
                    // Not a button key, we're done collecting bindings
                    break;
                }
            }
            
            return { bindings, nextIndex: i };
        }

        function convertToJSON(inputText) {
            const lines = inputText.split('\n').filter(line => line.trim() !== '');
            
            if (lines.length === 0) {
                throw new Error('Input is empty. Please provide key-value pairs.');
            }
            
            const containerData = {};
            let i = 0;
            
            while (i < lines.length) {
                const currentLine = lines[i].trim();
                
                // Check if current line is a known key
                if (KNOWN_KEYS.has(currentLine)) {
                    const key = currentLine;
                    
                    // Special handling for controllerEmulationBindings
                    if (key === "controllerEmulationBindings") {
                        i++; // Move past the controllerEmulationBindings key
                        const result = parseButtonBindings(lines, i);
                        containerData[key] = result.bindings;
                        i = result.nextIndex;
                    } else {
                        // Regular key handling
                        // Peek at the next line
                        const nextLine = i + 1 < lines.length ? lines[i + 1].trim() : undefined;
                        const nextLineIsKey = nextLine !== undefined && KNOWN_KEYS.has(nextLine);
                        
                        // If next line is also a known key or undefined, current key has empty value
                        if (nextLine === undefined || nextLineIsKey) {
                            containerData[key] = "";
                            i++; // Move to next line
                        } else {
                            // Next line is the value for this key
                            containerData[key] = parseValue(nextLine);
                            i += 2; // Skip both key and value
                        }
                    }
                } else {
                    throw new Error(`Unknown key "${currentLine}" at position ${i + 1}.`);
                }
            }
            
            return {
                version: 1,
                containerData: containerData
            };
        }

        function convertAndDownload() {
            const inputText = document.getElementById('inputText').value;
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            
            // Hide previous messages
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            
            try {
                const jsonData = convertToJSON(inputText);
                const jsonString = JSON.stringify(jsonData, null, 2);
                
                // Create a blob and download
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'config.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Show success message
                successMessage.textContent = 'JSON file downloaded successfully!';
                successMessage.style.display = 'block';
            } catch (error) {
                // Show error message
                errorMessage.textContent = 'Error: ' + error.message;
                errorMessage.style.display = 'block';
            }
        }

        // Allow Enter key in textarea (default behavior)
        document.getElementById('inputText').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                convertAndDownload();
            }
        });
    </script>
</body>
</html>
